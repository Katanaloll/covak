local HttpService = game:GetService("HttpService")
local StarterGui = game:GetService("StarterGui")
local pastebinURL = "https://pastebin.com/raw/nbZCTT4X" -- Your Pastebin raw link

-- Validate Key Before Running Script
local function validateKey()
    local success, response = pcall(function()
        return game:HttpGet(pastebinURL)
    end)

    if success and response then
        local validKeys = string.split(response, "\n")
        for _, key in ipairs(validKeys) do
            if getgenv().covakSettings.Main.Key == key then
                StarterGui:SetCore("SendNotification", {
                    Title = "Covak Key System",
                    Text = "Key is valid!",
                    Duration = 3
                })
                return true
            end
        end
    end

    StarterGui:SetCore("SendNotification", {
        Title = "Covak Key System",
        Text = "Key is not valid!",
        Duration = 3
    })

    return false
end

-- Stop Execution If Key Is Invalid
if not validateKey() then
    warn("⚠️ Invalid Key! Please enter a valid key in the settings table.")
    return
end

StarterGui:SetCore("SendNotification", {
    Title = "Covak Script",
    Text = "Config Updated! Key Verified.",
    Duration = 3
})

-- Camlock and Triggerbot Settings
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local function getClosestPlayerToMouse()
    local mouseLocation = UserInputService:GetMouseLocation()
    local closestPlayer, closestDistance = nil, math.huge

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local worldPos = player.Character.HumanoidRootPart.Position
            local screenPos, onScreen = Camera:WorldToViewportPoint(worldPos)

            if onScreen then
                local distance = (Vector2.new(screenPos.X, screenPos.Y) - mouseLocation).Magnitude
                if distance < closestDistance then
                    closestDistance = distance
                    closestPlayer = player
                end
            end
        end
    end
    return closestPlayer
end

local function getClosestPartOfPlayer(player)
    if player and player.Character then
        return player.Character:FindFirstChild(getgenv().covakSettings.Camlock.HitPart)
    end
    return nil
end

local lockedTarget, lockedPart, lastTargetPos = nil, nil, nil
local camlockEnabled = getgenv().covakSettings.Camlock.Enabled
local triggerbotEnabled = getgenv().covakSettings.Triggerbot.Enabled
local smoothnessX = getgenv().covakSettings.Camlock.Smoothness.X
local smoothnessY = getgenv().covakSettings.Camlock.Smoothness.Y
local predictionX = getgenv().covakSettings.Camlock.Prediction.X
local predictionY = getgenv().covakSettings.Camlock.Prediction.Y
local triggerDelay = getgenv().covakSettings.Triggerbot.Delay
local camlockKey = getgenv().covakSettings.Camlock.Keybind
local triggerbotKey = getgenv().covakSettings.Triggerbot.Keybind

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if input.KeyCode == camlockKey then
        camlockEnabled = not camlockEnabled
        if camlockEnabled then
            lockedTarget = getClosestPlayerToMouse()
            lockedPart = getClosestPartOfPlayer(lockedTarget)
            lastTargetPos = lockedPart and lockedPart.Position
            print("Locked onto:", lockedTarget and lockedTarget.Name or "None")
        else
            lockedTarget, lockedPart, lastTargetPos = nil, nil, nil
            print("Camlock Disabled")
        end
    end

    if input.KeyCode == triggerbotKey then
        triggerbotEnabled = not triggerbotEnabled
        print("Triggerbot:", triggerbotEnabled and "Enabled" or "Disabled")
    end
end)

local function updateCamlock()
    if camlockEnabled and lockedTarget then
        local humanoid = lockedTarget.Character and lockedTarget.Character:FindFirstChild("Humanoid")
        if humanoid and humanoid.Health <= 5 then
            camlockEnabled = false
            lockedTarget, lockedPart, lastTargetPos = nil, nil, nil
            return
        end

        if lockedPart then
            local predictedPos = lockedPart.Position + Vector3.new(
                lockedTarget.Character.HumanoidRootPart.Velocity.X * predictionX,
                lockedTarget.Character.HumanoidRootPart.Velocity.Y * predictionY,
                0
            )

            lastTargetPos = lastTargetPos and lastTargetPos:Lerp(predictedPos, smoothnessX) or predictedPos
            Camera.CFrame = Camera.CFrame:Lerp(CFrame.lookAt(Camera.CFrame.Position, lastTargetPos), smoothnessX)
        else
            camlockEnabled = false
            lockedTarget, lockedPart, lastTargetPos = nil, nil, nil
        end
    end
end

local function updateTriggerbot()
    if triggerbotEnabled then
        local mouse = LocalPlayer:GetMouse()
        local target = mouse.Target

        if target and target.Parent:IsA("Model") and target.Parent:FindFirstChild("Humanoid") then
            local humanoid = target.Parent:FindFirstChild("Humanoid")
            if humanoid and humanoid.Health > 0 then
                mouse1click()
            end
        end

        wait(triggerDelay)
    end
end

RunService.RenderStepped:Connect(updateCamlock)
while triggerbotEnabled do updateTriggerbot() end
